<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Other Subscriptions</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div class="container">
        <h2>Other Subscriptions</h2>

        <label for="service">Select Service</label>
        <select id="service">
            <option value="dstv">DSTV</option>
            <option value="gotv">GoTV</option>
            <option value="startimes">Startimes</option>
            <option value="electricity">Electricity Bill</option>
        </select>

        <label for="account">Account / Smart Card Number</label>
        <input type="text" id="account" placeholder="Enter account/smartcard number">

        <label for="amount">Amount (₦)</label>
        <input type="number" id="amount" placeholder="Enter amount">

        <button onclick="payForSubscription()">Proceed to Payment</button>
        <br><br>
        <a href="dashboard.html">⬅ Back to Dashboard</a>
    </div>

    <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
        function payForSubscription(){
            let service = document.getElementById("service").value;
            let account = document.getElementById("account").value;
            let amount = document.getElementById("amount").value;
            let email = firebase.auth().currentUser.email;

            let handler = PaystackPop.setup({
                key: 'pk_test_your_public_key_here', // Replace with your Paystack Public Key
                email: email,
                amount: amount * 100, 
                currency: "NGN",
                callback: function(response){
                    firebase.firestore().collection("transactions").add({
                        type: service,
                        user: email,
                        account: account,
                        amount: amount,
                        status: "success",
                        ref: response.reference,
                        date: new Date()
                    }).then(() => {
                        alert("Payment Successful! Your subscription will be processed.");
                        window.location.href = "dashboard.html";
                    });
                },
                onClose: function(){
                    alert('Transaction was not completed.');
                }
            });
            handler.openIframe();
        }
    </script>
</body>
</html>
